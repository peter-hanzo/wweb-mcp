version: '3.8'

services:
  whatsapp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: whatsapp-server
    environment:
      MODE: mcp                       # üëà –ò–∑–º–µ–Ω–∏ –Ω–∞ 'whatsapp-api' –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      API_PORT: 3001
      API_KEY: your-api-key
      SSE_PORT: 3002
      TRANSPORT: sse      # –ò–ª–∏ 'command' –¥–ª—è STDIN
      API_BASE_URL: http://localhost:3001/api
    ports:
      - "3001:3001"
      - "3002:3002"
    restart: unless-stopped


  whatsapp-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: whatsapp-mcp
    ports:
      - "3002:3002"   # –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ MCP
    environment:
      - MODE=mcp
      - TRANSPORT=sse       # –ò–ª–∏ 'command' –¥–ª—è STDIN
      - SSE_PORT=3002
      - MCP_MODE=server
      - API_BASE_URL=http://whatsapp-api:3001/api  # –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API —Å–µ—Ä–≤–µ—Ä–∞
      - API_KEY=your-api-key  # –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    command: >
      node dist/main.js
      --mode mcp
      --transport sse
      --sse-port 3002
      --api-base-url http://whatsapp-api:3001/api
    restart: unless-stopped
    depends_on:
      - whatsapp-api   # –û–∂–∏–¥–∞–µ–º —Å—Ç–∞—Ä—Ç–∞ whatsapp-api
    networks:
      - whatsapp-network  # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±—â–µ–π —Å–µ—Ç–∏

networks:
  whatsapp-network:
    driver: bridge  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–µ—Ç–∏ 'bridge'
